# 이벤트 버블링, 캡쳐링, 위임

**이벤트 버블링**은 특정 화면 요소에서 이벤트가 발생했을 때 해당 이벤트 객체가 더 상위의 (부모) 화면 요소들로 전달되어 가는 특성을 말한다.

**이벤트 캡쳐링**은 특정 화면 요소에서 이벤트가 발생했을 때, 이벤트 버블링과 반대 방향인 최상위 요소에서 이벤트가 발생한 화면 요소까지 이벤트 객체가 전파되는 특성을 말한다.

**이벤트 위임**은 하위 요소 각각에 이벤트를 붙이지 않고 상위 요소에서 하위 요소의 이벤트를 제어하는 방식이다.  



### 이벤트 버블링(event bubbling)

브라우저는 특정 화면 요소에서 이벤트가 발생했을 때, 해당 이벤트를 DOM 트리 최상위에 있는 화면 요소까지 이벤트를 전파시킨다. 즉, 이벤트가 발생했을 떄 해당 화면 요소의 이벤트 핸들러가 동작하고, 해당 화면 요소의 부모 요소의 이벤트 핸들러가 동작하는 과정을 최상위 화면 요소의 이벤트 핸들러가 동작할 때까지 반복한다. 

* 핸들러가 이벤트를 처리하고 난 후 버블링을 하지 않도록 하려면 다음 두 가지의 매서드를 사용할 수 있다. 
  * `event.stopPropagation()` 매서드를 사용하면 **위쪽**으로 일어나는 버블링을 막아준다. 
  * `event.stopImmediatePropagation()` 매서드를 사용하면 요소에 할당된 특정 이벤트를 처리하는 모든 핸들러의 동작을 막아준다. 

* 버블링은 되도록 막지 않는 것이 좋다.

* 거의 모든 이벤트는 버블링되는데, 예외가 있다 (e.g., [focus](https://developer.mozilla.org/en-US/docs/Web/API/Element/focus_event)). 



### 이벤트 캡쳐링(event capturing)

이벤트 버블링과 반대 방향으로 진행되는 이벤트 전파 방식이다. 특정 화면 요소에서 이벤트가 발생했을 때, 최상위 요소에서 이벤트가 발생한 태그까지 이벤트 객체가 전파된다.

캡쳐링을 이용하는 경우는 흔치 않다. 

아래와 같이 작성하면 캡쳐링 단계에서 이벤트 객체를 잡을 수 있다. `capture`의 디폴트 값은 `false`이다.

```javascript
elem.addEventListener(..., {capture: true})
// {capture: true} 대신, true를 써줘도 된다.
elem.addEventListener(..., true)
```



아래 그림은 `#buttonOne`에서 클릭이벤트가 발생했을 때 이벤트 객체가 전파되는 것을 나타낸 그림이다. 

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fc5sUxb%2FbtqVuf1ZKGX%2FkERTipZDKfmz0mjKPsM6x1%2Fimg.png" alt="Event bubbling & capturing" style="zoom:50%;" />



### 이벤트 위임(event delegation)

하위 요소 각각에 이벤트를 붙이지 않고 **이벤트 버블링과 캡쳐링 특성을 이용해** 상위 요소에서 하위 요소의 이벤트를 제어하는 방식이다.  

예를 들어, 리스트 아이템을 새롭게 추가할 때마다 이벤트 리스너를 일일이 추가할 필요 없이, 부모 요소에서 자식 요소의 이벤트를 감지하고 제어할 수 있다. 

이벤트 위임을 활용하면, 많은 핸들러를 일일이 할당하지 않아도 되기 때문에 초기화가 단순해지고 메모리가 절약되는 장점이 있다. 

주의할 점은, 이벤트 위임을 활용하기 위해서는 이벤트가 반드시 버블링되어야 한다. 버블링되지 않는 이벤트(e.g., `focus`)에는 활용할 수 없다. 



## 정리

**이벤트 버블링**은 특정 화면 요소에서 이벤트가 발생했을 때 해당 이벤트 객체가 더 상위의 (부모) 화면 요소들로 전달되어 가는 특성을 말한다.

**이벤트 캡쳐링**은 특정 화면 요소에서 이벤트가 발생했을 때, 이벤트 버블링과 반대 방향인 최상위 요소에서 이벤트가 발생한 화면 요소까지 이벤트 객체가 전파되는 특성을 말한다.

**이벤트 위임**은 이벤트 버블링과 캡쳐링을 활용한 이벤트 핸들링 방식으로, 하위 요소 각각에 이벤트를 붙이지 않고 상위 요소에서 하위 요소의 이벤트를 제어할 수 있다. 



## 참고자료

https://www.w3.org/TR/DOM-Level-3-Events/

https://ko.javascript.info/bubbling-and-capturing

https://ko.javascript.info/event-delegation

